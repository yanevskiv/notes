\clearpage
\section{Mutual exclusion}
\textbf{\large Zadatak} Proces je pokrenuo dve niti, gde prva nit popunjava deljeni niz znakova znakom 'a', dok druga nit popunjava niz znakova znakom 'b'. Ove dve niti remete rad jedna drugoj, time \v{s}to se utrkuju (race condition) i "gaze" podatke druge niti svojim podacima. Koriste\'{c}i monitore, potrebno je za\v{s}titi niz znakova tako da jedna nit ne mo\v{z}e da zapo\v{c}ne upis dok druga nit ne potpuno zavr\v{s}i.
\\\\
\textbf{Re\v{s}enje sa \texttt{Signal-and-Wait} disciplinom}
\begin{lstlisting}
#include <thread.h>
#include <monitor.h>
class CriticalSection : SW_Monitor {
    bool m_locked = false;
    cond m_delay;
public:
    CriticalSection() : m_delay(this) {

    }
    void enter_section() {
        monitor {
            if (m_locked) 
                m_delay.wait();
            m_locked = true;
        }
    }

    void exit_section() {
        monitor {
            m_locked = false;
            m_delay.signal();
        }
    }

} cs;

char buffer[BUFSIZ];
void a() {
    while (true) {
        cs.enter_section();
        memset(buffer, 'a', BUFSIZ);
        cs.exit_section();
        usleep(100);
    }
}

void b() {
    while (true) {
        cs.enter_section();
        memset(buffer, 'b', BUFSIZ);
        cs.exit_section();
        usleep(10);
    }
}

int main() {
    Thread ta = createThread(a);
    Thread tb = createThread(b);
    join(ta);
    join(tb);
    return 0;
}

\end{lstlisting}
\newpage
\textbf{Re\v{s}enje sa \texttt{Signal-and-Continue} disciplinom}
\begin{lstlisting}
#include <thread.h>
#include <monitor.h>

class CriticalSection : SC_Monitor {
    bool m_locked = false;
    cond m_delay;
public:
    CriticalSection() : m_delay(this) {

    }
    void enter_section() {
        monitor {
            while (m_locked) 
                m_delay.wait();
            m_locked = true;
        }
    }

    void exit_section() {
        monitor {
            m_locked = false;
            m_delay.signal();
        }
    }

} cs;

char buffer[BUFSIZ];
void a() {
    while (true) {
        cs.enter_section();
        memset(buffer, 'a', BUFSIZ);
        cs.exit_section();
    }
}

void b() {
    while (true) {
        cs.enter_section();
        memset(buffer, 'b', BUFSIZ);
        cs.exit_section();
    }
}

int main() {
    Thread ta = createThread(a);
    Thread tb = createThread(b);
    join(ta);
    join(tb);
    return 0;
}

\end{lstlisting}
